# JS的允许机制

## 单线程

同一时间只能做一件事情。

## js事件循环/event loop

主线程 -> 异步任务（微任务 -> 宏任务）

* **微任务** ：包括了 `promise` 的回调、node 中的 `process.nextTick`（所有异步的 **No.1** ） 、对 Dom 变化监听的 `MutationObserver`。 

* **宏任务** ：包括了 script 脚本的执行、`setTimeout` ，`setInterval` ，`setImmediate` 一类的定时事件，还有如 `I/O 操作`、`UI 渲染`等。

* **完整流程** ：

  1. 首先js 是单线程运行的，在代码执行的时候，通过将不同函数的执行上下文压入执行栈中来保证代码的有序执行。

  2. 在执行同步代码的时候，如果遇到了异步事件，js 引擎并不会一直等待其返回结果，而是会将这个事件挂起，继续执行执行栈中的其他任务

  3. 当同步事件执行完毕后，再将异步事件对应的回调加入到与当前执行栈中不同的另一个任务队列中等待执行。

  4. 任务队列可以分为宏任务对列和微任务对列，当当前执行栈中的事件执行完毕后，js 引擎首先会判断微任务对列中是否有任务可以执行，如果有就将微任务队首的事件压入栈中执行。

  5. 当微任务对列中的任务都执行完成后再去判断宏任务对列中的任务。
